!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e){function i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}window.setViewPort("up");var r,a=document.getElementById("game"),l=document.getElementById("levelInfo"),c=a.getContext("2d"),h=a.width,u=a.height,f=a.offsetTop,d=a.offsetLeft;c.fillStyle="#ffffff",c.fillRect(0,0,h,u);var R=function(){function t(e,i){n(this,t),this.x=e,this.y=i}return s(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"distanceTo",value:function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}}]),t}(),v=function(){function t(e,o,s){n(this,t),i(this,"minRadius",10),i(this,"minWidth",6),i(this,"maxRadius",this.minRadius+this.minWidth+4),i(this,"maxWidth",12),i(this,"outerRadius",this.maxRadius+10),i(this,"nums",15),i(this,"pointRadius",4),i(this,"pointLen",this.maxRadius+6),i(this,"colorGroup",[["#31b0da","#81deea"],["#9c27b0","#d891e4"]]),this.centerPoint=e,this.type=o,this.director=s}return s(t,[{key:"render",value:function(){c.beginPath(),c.moveTo(this.centerPoint.x+this.maxRadius,this.centerPoint.y),c.arc(this.centerPoint.x,this.centerPoint.y,this.maxRadius,0,2*Math.PI),c.closePath(),c.fillStyle="#ffffff",c.fill(),c.beginPath(),c.strokeStyle=this.getColor(),c.lineWidth=5,c.lineJoin="bevel";for(var e,i,n,o,s,r,a=2*this.nums,l=0;l<a;l++)o=2*Math.PI/a*(l+1),n=l%2==0?this.maxRadius:this.outerRadius,e=this.centerPoint.x+n*Math.sin(o),i=this.centerPoint.y+n*Math.cos(o),0==l?c.moveTo(e,i):c.lineTo(e,i);switch(c.closePath(),c.stroke(),c.beginPath(),c.strokeStyle=this.getColor(),c.lineWidth=this.minWidth,c.moveTo(this.centerPoint.x+this.minRadius,this.centerPoint.y),c.arc(this.centerPoint.x,this.centerPoint.y,this.minRadius,0,2*Math.PI),c.closePath(),c.stroke(),c.beginPath(),c.strokeStyle=this.getLinerColor(),c.lineWidth=this.maxWidth,c.moveTo(this.centerPoint.x+this.maxRadius,this.centerPoint.y),c.arc(this.centerPoint.x,this.centerPoint.y,this.maxRadius,0,2*Math.PI),c.closePath(),c.stroke(),c.beginPath(),c.fillStyle="#ffff00",c.moveTo(this.centerPoint.x+this.pointRadius,this.centerPoint.y),c.arc(this.centerPoint.x,this.centerPoint.y,this.pointRadius,0,2*Math.PI),c.closePath(),c.fill(),c.beginPath(),c.fillStyle="#ffff00",c.moveTo(this.centerPoint.x+this.pointRadius,this.centerPoint.y),c.arc(this.centerPoint.x,this.centerPoint.y,this.pointRadius,0,2*Math.PI),c.closePath(),c.fill(),c.beginPath(),c.strokeStyle="#ffff00",c.lineWidth=4,c.moveTo(this.centerPoint.x,this.centerPoint.y),this.director){case t.DIRECTOR.up:s=this.centerPoint.x,r=this.centerPoint.y-this.pointLen;break;case t.DIRECTOR.right:s=this.centerPoint.x+this.pointLen,r=this.centerPoint.y;break;case t.DIRECTOR.down:s=this.centerPoint.x,r=this.centerPoint.y+this.pointLen;break;case t.DIRECTOR.left:s=this.centerPoint.x-this.pointLen,r=this.centerPoint.y}c.lineTo(s,r),c.closePath(),c.stroke()}},{key:"turn",value:function(){this.director=this.getNextDir(),this.render()}},{key:"getNextDir",value:function(){var e,n;return(this.type==t.TYPE.b?(i(e={},t.DIRECTOR.up,t.DIRECTOR.left),i(e,t.DIRECTOR.left,t.DIRECTOR.down),i(e,t.DIRECTOR.down,t.DIRECTOR.right),i(e,t.DIRECTOR.right,t.DIRECTOR.up),e):(i(n={},t.DIRECTOR.up,t.DIRECTOR.right),i(n,t.DIRECTOR.left,t.DIRECTOR.up),i(n,t.DIRECTOR.down,t.DIRECTOR.left),i(n,t.DIRECTOR.right,t.DIRECTOR.down),n))[this.director]}},{key:"getColor",value:function(){return this.type==t.TYPE.a?this.colorGroup[0][0]:this.colorGroup[1][0]}},{key:"getLinerColor",value:function(){var e=c.createRadialGradient(this.centerPoint.x,this.centerPoint.y,this.minRadius,this.centerPoint.x,this.centerPoint.y,this.maxRadius);e.addColorStop(0,this.colorGroup[0][0]),e.addColorStop(1,this.colorGroup[0][1]);var i=c.createRadialGradient(this.centerPoint.x,this.centerPoint.y,this.minRadius,this.centerPoint.x,this.centerPoint.y,this.maxRadius);return i.addColorStop(0,this.colorGroup[1][0]),i.addColorStop(1,this.colorGroup[1][1]),this.type==t.TYPE.a?e:i}}]),t}();v.TYPE={a:0,b:1},v.DIRECTOR={up:0,right:1,down:2,left:3};var P=function(){function t(){n(this,t),i(this,"firstPoint",new R(40,40)),i(this,"step",80),i(this,"level",0),i(this,"levelList",void 0),i(this,"clList",[]),i(this,"running",!1),window.levelData?this.levelList=window.levelData:window.toast(window.getFailFaceSvg()+'<span class="msg">暂无关卡！</span>',2e3)}return s(t,[{key:"start",value:function(){this.levelList&&this.levelList.length&&(this.loadLevel(),this.listen())}},{key:"restart",value:function(){c.fillStyle="#ffffff",c.fillRect(0,0,h,u),this.loadLevel()}},{key:"nextLevel",value:function(){this.level==this.levelList.length-1?window.toast(window.getFailFaceSvg()+'<span class="msg">没有更多关卡了。</span>',2e3):(this.level++,this.restart())}},{key:"resetEnv",value:function(){this.clList=[],this.running=!1}},{key:"loadLevel",value:function(){this.resetEnv();var t=this.levelList[this.level];7==t.length?this.render(t):window.toast(window.getFailFaceSvg()+'<span class="msg">关卡数据不正确！</span>',2e3)}},{key:"render",value:function(t){var e=this;t.forEach((function(t,i){e.clList[i]=[],t.forEach((function(t,n){var o=new R(e.firstPoint.x+e.step*n,e.firstPoint.y+e.step*i),s=new v(o,t[0],t[1]);s.pos=new R(i,n),s.render(),e.clList[i].push(s)}))}))}},{key:"drawLine",value:function(t,e){var i,n,o,s,r=t.outerRadius;switch(i=t.centerPoint.x,n=t.centerPoint.y,o=e.centerPoint.x,s=e.centerPoint.y,t.director){case v.DIRECTOR.up:n-=r,s+=r;break;case v.DIRECTOR.down:n+=r,s-=r;break;case v.DIRECTOR.left:i-=r,o+=r;break;case v.DIRECTOR.right:i+=r,o-=r}c.beginPath(),c.strokeStyle="rgba(0,0,255,0.3)",c.lineWidth=6,c.moveTo(i,n),c.lineTo(o,s),c.closePath(),c.stroke()}},{key:"loop",value:function(t){var e=t.pos,i=e.x,n=e.y,o=t.getNextDir(),s=this;switch(o){case v.DIRECTOR.up:i--;break;case v.DIRECTOR.right:n++;break;case v.DIRECTOR.down:i++;break;case v.DIRECTOR.left:n--}t.turn(),6==e.y&&7==n?setTimeout((function(){window.toast(window.getSmailFaceSvg()+'<span class="msg">恭喜，成功解锁本关！</span>',2e3)}),1e3):i<0||n<0||i>6||n>6?setTimeout((function(){window.toast(window.getFailFaceSvg()+'<span class="msg">很遗憾，解锁失败！</span>',2e3)}),1e3):setTimeout((function(){s.drawLine(t,s.clList[i][n]),s.loop(s.clList[i][n])}),1e3)}},{key:"handlerPoint",value:function(t){var e=this;this.clList.forEach((function(i,n){i[0].centerPoint.distanceTo(t)<i[0].maxRadius&&(e.running=!0,e.loop(i[0]))}))}},{key:"listen",value:function(){var t=this,e=this.handlerPoint.bind(this);window.onresize=function(t){d=a.offsetLeft},a.addEventListener("click",(function(i){if(!t.running){var n=new R(i.x-d,i.y-f);e(n)}}))}}]),t}();window.onload=function(){(r=new P).start(),l.innerHTML="第【".concat(r.level+1,"】关")},document.getElementById("reset").addEventListener("click",(function(){r.restart()})),document.getElementById("next").addEventListener("click",(function(){r.nextLevel(),l.innerHTML="第【".concat(r.level+1,"】关")}))}]);